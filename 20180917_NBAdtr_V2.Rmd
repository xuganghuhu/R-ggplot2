---
title: "20181013_NBA_ggplot2"
author: "hu"
date: "2018年10月13日"
output: html_document
---

```{r setup, include=FALSE}
#载入分析所需要的包
library(dplyr)
library(devtools)
library(woe)   
library(ROSE)
library(rpart)
library(rpart.plot)
library(ggplot2)
require(caret)
library(pROC)
```

# NBA数据可视化

本次分析数据为2016-2017赛季NBA300多为球员的技术统计。
数据来源：  
感谢简书用户“牧羊的男孩”，地址如下：   
https://pan.baidu.com/s/1VjMGm9uzmeb5lnzPkGpD-Q  
以下为“牧羊的男孩”提供的数据字段解释，非常感谢！   
![](https://upload-images.jianshu.io/upload_images/6857799-e501c762be529100.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)

## 数据准备

```{r}
dat_nba<-read.csv('nba_2017_nba_players_with_salary.csv')
dat_nba$cut_salary<-ifelse(dat_nba$SALARY_MILLIONS>15,1,0)
dat_nba$cut_salary<-as.factor(dat_nba$cut_salary)
#dat_nba<-select(dat_nba,-PLAYER,-SALARY_MILLIONS,-TEAM)
#summary(dat_nba$cut_salary)
cat('\n','前30位球员：')
#names(dat_nba)
dat_nba[1:15,]
#filter(dat_nba,TEAM=='GS') 检查PACE是否为作者所说的球队得分
```

## 球员可视化数据分析
### ggplot2 作图原理简要举例

```{r}
dat_nba1<-select(dat_nba,-X,-Rk) #去掉序号字段
dat_nba1$cut_age<-ifelse(dat_nba1$AGE>=30,'30++',ifelse(dat_nba1$AGE>=25,'25-29','25--'))  #添加一个字段：切分老中青3个年龄段

ggplot(dat_nba1,aes(POSITION))+geom_bar(stat='count') #条形图
ggplot(dat_nba1,aes(POSITION,POINTS))+geom_bar(stat='identity')+coord_flip() #柱状图图
ggplot(dat_nba1,aes(MP,POINTS))+geom_point() #散点图
ggplot(dat_nba1,aes(MP,POINTS))+geom_dotplot() #dot图
ggplot(dat_nba1,aes(POSITION,POINTS))+geom_boxplot() #箱线图
ggplot(dat_nba1,aes(cut_age))+geom_bar(stat='count')+coord_polar(theta = "x") #饼图--条形图的特殊形式

```



### 条形图
```{r}
## 条形图
ggplot(dat_nba1,aes(POSITION))+                        
  geom_bar(fill='skyblue2',color='black')+
  labs(title='Bar')

#filter(dat_nba1,POSITION=='PF-C')%>%select(PLAYER,POINTS,TRB,AST,STL,BLK,TEAM,POSITION,SALARY_MILLIONS)

## 条形图-分面
ggplot(dat_nba1,aes(POSITION))+                        
  geom_bar(fill='green3',color='black')+coord_flip()+
  labs(title='Bar--facet')

## 并立$堆叠条形图 
ggplot(dat_nba1,aes(cut_age,fill=POSITION))+
  geom_bar(position = 'dodge')+                        #并列dodge  堆叠stack
  labs(title='Bar--dodge')             

## 条形图--饼图
ggplot(dat_nba1,aes(POSITION),color=POSITION)+                        
  geom_bar(fill='red3',color='black')+
  facet_grid(~cut_age)+
  labs(title='Bar--facet')+
  coord_polar(theta = "x")

## 直方图
ggplot(dat_nba1,aes(AGE))+
  geom_histogram(binwidth=1,color='black',fill='orange2')+
  scale_y_continuous(limits=c(0,35),breaks =seq(0,40,5)) + 
  scale_x_continuous(limits=c(19,40),breaks =seq(20,40,5)) +
  labs(title='Hist') 
```

### 得分效率分析

```{r}
plot(dat_nba1$MP,dat_nba1$POINTS)
ggplot(dat_nba1,aes(x=MP,y=POINTS))+geom_point()

ggplot(dat_nba1,aes(x=MP,y=POINTS,color=cut_age))+geom_point()+theme_gray()
ggplot(dat_nba1,aes(x=MP,y=POINTS,color=cut_age))+geom_smooth()+theme_light()

ggplot(dat_nba1,aes(x=MP,y=POINTS,color=cut_age))+geom_point()+geom_text(aes(label=PLAYER),color='black',check_overlap = TRUE)+theme_void()
ggplot(filter(dat_nba1,POINTS>23,MP>30),aes(x=MP,y=POINTS,color=cut_age))+geom_point()+geom_text(aes(label=PLAYER),color='black',check_overlap = TRUE)+theme_void()
```

### 篮板球效率分析
```{r}
dat_nba1$rate_RB<-dat_nba1$ORB/dat_nba1$DRB   #生成篮板率的指标

ggplot(dat_nba1,aes(TRB,rate_RB,color=POSITION))+geom_point()+geom_smooth()   #method = 'loess',se=FALSE

ggplot(dat_nba1,aes(TRB,rate_RB,color=POSITION))+geom_point()+
  geom_text(aes(label=(PLAYER)),color='black',check_overlap = T)+
  theme_classic()

#filter(dat_nba1,PLAYER=='Mike Tobey')%>%select(PLAYER,MP,POINTS,TRB,AST,STL,BLK,TEAM,POSITION,SALARY_MILLIONS)
```
### 箱线图
```{r}

ggplot(dat_nba1,aes(cut_age,POINTS,fill=POSITION))+geom_boxplot()+theme_classic()   #geom_text(aes(label=PLAYER),color='black',check_overlap = TRUE)

ggplot(dat_nba1,aes(cut_age,POINTS,fill=POSITION))+geom_violin(alpha=0.5)+theme_classic()

```


### 按球队分析
```{r}
dat_nba1$num<-1
dat_grp<-group_by(dat_nba1,TEAM)%>%
  summarise(cnt=sum(num),AVG_points=mean(POINTS),AVG_TRB=mean(TRB),AVG_AST=mean(AST),AVG_STL=mean(STL),AVG_BLK=mean(BLK),AVG_SALARY=mean(SALARY_MILLIONS))%>%
  filter(cnt>=5)

dat_grp_seed<-dat_grp[order(-dat_grp$AVG_SALARY),][1:15,]  #构造得分能力最强的10个球队
dat_grp_seed
dat_nba3<-merge(dat_nba1,dat_grp_seed,by='TEAM') #匹配seed

ggplot(dat_nba3,aes(TEAM,POINTS,fill=TEAM))+geom_boxplot()+theme_classic()

ggplot(dat_nba3,aes(TEAM,POINTS,fill=TEAM))+geom_boxplot()+geom_text(aes(label=PLAYER),color='black',check_overlap = TRUE)+theme_void()

```






